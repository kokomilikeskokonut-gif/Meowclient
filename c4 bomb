local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- // Configuration
local Settings = {
    Active = false,
    Radius = 7,     -- Distance from player
    Height = 1.5,   -- Vertical offset
    TP_Speed = 0.05 -- How fast you change positions (lower = faster flickering)
}

local TargetPlayer = nil
local PlayerList = {}
local CurrentIndex = 1
local LockedTool = nil

-- // UI Setup
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 200, 0, 150)
Main.Position = UDim2.new(0, 50, 0.5, -75)
Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Main.Active = true
Main.Draggable = true
Instance.new("UICorner", Main)

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "TP-ORBIT (Flicker)"
Title.BackgroundColor3 = Color3.fromRGB(255, 80, 0)
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.GothamBold

local NameDisplay = Instance.new("TextLabel", Main)
NameDisplay.Size = UDim2.new(1, 0, 0, 40)
NameDisplay.Position = UDim2.new(0, 0, 0.25, 0)
NameDisplay.BackgroundTransparency = 1
NameDisplay.TextColor3 = Color3.new(1,1,1)
NameDisplay.Text = "Select Target"

local NextBtn = Instance.new("TextButton", Main)
NextBtn.Size = UDim2.new(0, 30, 0, 30)
NextBtn.Position = UDim2.new(0.8, 0, 0.3, 0)
NextBtn.Text = ">"

local PrevBtn = Instance.new("TextButton", Main)
PrevBtn.Size = UDim2.new(0, 30, 0, 30)
PrevBtn.Position = UDim2.new(0.05, 0, 0.3, 0)
PrevBtn.Text = "<"

local Status = Instance.new("TextLabel", Main)
Status.Size = UDim2.new(1, 0, 0, 30)
Status.Position = UDim2.new(0, 0, 0.75, 0)
Status.BackgroundTransparency = 1
Status.Text = "STATUS: IDLE [K]"
Status.TextColor3 = Color3.fromRGB(200, 200, 200)

-- // Functions
local function GetFirstWeapon()
    local items = LocalPlayer.Backpack:GetChildren()
    for _, item in pairs(items) do
        if item:IsA("Tool") then return item end
    end
    return nil
end

local function UpdateUI()
    PlayerList = {}
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer then table.insert(PlayerList, v) end
    end
    if #PlayerList > 0 then
        if CurrentIndex > #PlayerList then CurrentIndex = 1 end
        if CurrentIndex < 1 then CurrentIndex = #PlayerList end
        TargetPlayer = PlayerList[CurrentIndex]
        NameDisplay.Text = TargetPlayer.Name
    end
end

NextBtn.MouseButton1Click:Connect(function() CurrentIndex += 1 UpdateUI() end)
PrevBtn.MouseButton1Click:Connect(function() CurrentIndex -= 1 UpdateUI() end)
UpdateUI()

-- // TP LOOP
local lastTP = 0
RunService.Heartbeat:Connect(function()
    if not Settings.Active or not TargetPlayer or not TargetPlayer.Character then return end
    
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local targetHrp = TargetPlayer.Character:FindFirstChild("HumanoidRootPart")
    local camera = workspace.CurrentCamera

    if hrp and targetHrp then
        -- 1. Flicker Teleport Logic
        if tick() - lastTP >= Settings.TP_Speed then
            lastTP = tick()
            
            -- Randomize angle for the TP
            local randomAngle = math.rad(math.random(0, 360))
            local offset = Vector3.new(
                math.cos(randomAngle) * Settings.Radius, 
                Settings.Height, 
                math.sin(randomAngle) * Settings.Radius
            )
            
            -- Teleport and Look at target
            hrp.CFrame = CFrame.new(targetHrp.Position + offset, targetHrp.Position)
            camera.CFrame = CFrame.new(camera.CFrame.Position, targetHrp.Position)
        end
        
        -- 2. Slot 1 Auto-Attack
        if LockedTool then
            if LockedTool.Parent ~= char then LockedTool.Parent = char end
            LockedTool:Activate()
        end
    end
end)

-- // Toggle
UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.K then
        Settings.Active = not Settings.Active
        
        if Settings.Active then
            LockedTool = GetFirstWeapon()
            Status.Text = "ACTIVE: " .. (LockedTool and LockedTool.Name or "No Tool")
            Status.TextColor3 = Color3.fromRGB(0, 255, 0)
            
            -- Noclip
            if LocalPlayer.Character then
                for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = false end
                end
            end
        else
            Status.Text = "STATUS: IDLE"
            Status.TextColor3 = Color3.fromRGB(200, 200, 200)
            LockedTool = nil
            if LocalPlayer.Character then
                for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = true end
                end
            end
        end
    end
end)
